<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØªØ±Ø§Ø´Ø§Ù¾ - Ù†Ø³Ø®Ù‡ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø§ Ú©Ø´ Ù…Ø­Ù„ÛŒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .cache-stats {
            background: #e6fffa;
            border: 2px solid #38b2ac;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .cache-hit {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .cache-miss {
            background: #fed7d7;
            color: #742a2a;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ›ï¸ ØªØªØ±Ø§Ø´Ø§Ù¾ - Ù†Ø³Ø®Ù‡ Ù¾ÛŒØ´Ø±ÙØªÙ‡</h1>
            <div class="cache-stats" id="cacheStats">
                ğŸ“Š ÙˆØ¶Ø¹ÛŒØª Ú©Ø´: Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...
            </div>
        </div>
        
        <div id="app">
            <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ© -->
        </div>
    </div>

    <script>
        // Ø³ÛŒØ³ØªÙ… Ú©Ø´ Ù¾ÛŒØ´Ø±ÙØªÙ‡
        const searchCache = {
            set: (query, results, ttl = 5 * 60 * 1000) => { // 5 Ø¯Ù‚ÛŒÙ‚Ù‡ TTL
                const item = {
                    data: results,
                    expiry: Date.now() + ttl,
                    timestamp: new Date().toLocaleString('fa-IR')
                };
                localStorage.setItem(`search_${query}`, JSON.stringify(item));
                this.updateStats();
            },
            
            get: (query) => {
                const itemStr = localStorage.getItem(`search_${query}`);
                if (!itemStr) return null;
                
                const item = JSON.parse(itemStr);
                if (Date.now() > item.expiry) {
                    localStorage.removeItem(`search_${query}`);
                    return null;
                }
                
                return item;
            },
            
            clear: () => {
                Object.keys(localStorage).forEach(key => {
                    if (key.startsWith('search_')) {
                        localStorage.removeItem(key);
                    }
                });
                this.updateStats();
            },
            
            getAll: () => {
                const items = [];
                Object.keys(localStorage).forEach(key => {
                    if (key.startsWith('search_')) {
                        const item = JSON.parse(localStorage.getItem(key));
                        if (Date.now() <= item.expiry) {
                            items.push({
                                query: key.replace('search_', ''),
                                ...item
                            });
                        }
                    }
                });
                return items;
            },
            
            updateStats: () => {
                const items = this.getAll();
                const statsElement = document.getElementById('cacheStats');
                statsElement.innerHTML = `
                    ğŸ“Š ÙˆØ¶Ø¹ÛŒØª Ú©Ø´: ${items.length} Ø¬Ø³ØªØ¬ÙˆÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡
                    <br>
                    <small>${items.map(item => `${item.query} (${item.timestamp})`).join(', ')}</small>
                `;
            }
        };

        // Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ
        function renderUI() {
            const app = document.getElementById('app');
            const cachedItems = searchCache.getAll();
            
            app.innerHTML = `
                <div style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px;">
                    <h3>ğŸ” Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡</h3>
                    <input type="text" id="searchInput" placeholder="Ø¹Ø¨Ø§Ø±Øª Ø¬Ø³ØªØ¬Ùˆ..." 
                           style="width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #e2e8f0; border-radius: 8px;"
                           value="Ø±Ø§Ù…ÛŒÙ† Ø§Ø¬Ù„Ø§Ù„">
                    <button onclick="performSearch()" 
                            style="background: #667eea; color: white; border: none; padding: 12px 30px; border-radius: 8px; width: 100%; cursor: pointer;">
                        ğŸ” Ø§Ø¬Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ
                    </button>
                    
                    <div style="margin-top: 15px;">
                        <button onclick="clearCache()" style="background: #f56565; color: white; border: none; padding: 8px 16px; border-radius: 6px; margin-left: 10px; cursor: pointer;">
                            ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ø´
                        </button>
                        <button onclick="viewCache()" style="background: #48bb78; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                            ğŸ‘ï¸ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø´
                        </button>
                    </div>
                </div>
                
                <div id="results" style="background: white; border-radius: 15px; padding: 25px;">
                    <div style="text-align: center; color: #667eea;">
                        ğŸ” Ù†ØªØ§ÛŒØ¬ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯...
                    </div>
                </div>
                
                <div id="cacheView" style="display: none; background: #f7fafc; border-radius: 15px; padding: 20px; margin-top: 15px;">
                    <h4>ğŸ‘ï¸ Ù…Ø­ØªÙˆØ§ÛŒ Ú©Ø´</h4>
                    <div id="cacheContent"></div>
                </div>
            `;
            
            searchCache.updateStats();
        }

        // Ø¹Ù…Ù„Ú©Ø±Ø¯Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
        async function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;
            
            const resultsElement = document.getElementById('results');
            
            // Ú†Ú© Ú©Ø±Ø¯Ù† Ú©Ø´
            const cached = searchCache.get(query);
            if (cached) {
                resultsElement.innerHTML = `
                    <div class="cache-hit" style="padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        âœ… <strong>Ù†ØªÛŒØ¬Ù‡ Ø§Ø² Ú©Ø´ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯</strong> (Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø¯Ø±: ${cached.timestamp})
                    </div>
                    ${renderResults(cached.data, query)}
                `;
                return;
            }
            
            resultsElement.innerHTML = '<div style="text-align: center; padding: 20px;">â³ Ø¯Ø± Ø­Ø§Ù„ Ø¬Ø³ØªØ¬Ùˆ...</div>';
            
            try {
                const response = await fetch('http://localhost:3003');
                const data = await response.json();
                
                // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ú©Ø´
                searchCache.set(query, data);
                
                resultsElement.innerHTML = `
                    <div class="cache-miss" style="padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        ğŸ”„ <strong>Ù†ØªÛŒØ¬Ù‡ Ø§Ø² Ø³Ø±ÙˆØ± Ø¯Ø±ÛŒØ§ÙØª Ùˆ Ø¯Ø± Ú©Ø´ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯</strong>
                    </div>
                    ${renderResults(data, query)}
                `;
                
            } catch (error) {
                resultsElement.innerHTML = `
                    <div style="background: #fed7d7; color: #c53030; padding: 15px; border-radius: 8px;">
                        âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¬Ø³ØªØ¬Ùˆ: ${error.message}
                    </div>
                `;
            }
        }

        function renderResults(data, query) {
            if (data.success && data.data && data.data.results) {
                return `
                    <h4>ğŸ“Š Ù†ØªØ§ÛŒØ¬ Ø¨Ø±Ø§ÛŒ "${query}"</h4>
                    ${data.data.results.map((result, index) => `
                        <div style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; margin: 10px 0; background: #f7fafc;">
                            <div style="font-weight: bold; margin-bottom: 8px;">${result.title}</div>
                            <div>${result.content}</div>
                            <div style="margin-top: 8px; color: #667eea;">
                                ğŸ”— Ø§Ø±ØªØ¨Ø§Ø·: ${Math.round((result.relevance || 0.8) * 100)}%
                            </div>
                        </div>
                    `).join('')}
                `;
            }
            return `<div>Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</div>`;
        }

        function clearCache() {
            searchCache.clear();
            alert('Ú©Ø´ Ù¾Ø§Ú© Ø´Ø¯!');
        }

        function viewCache() {
            const cacheView = document.getElementById('cacheView');
            const cacheContent = document.getElementById('cacheContent');
            const cachedItems = searchCache.getAll();
            
            if (cachedItems.length === 0) {
                cacheContent.innerHTML = '<div>Ú©Ø´ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª</div>';
            } else {
                cacheContent.innerHTML = cachedItems.map(item => `
                    <div style="border: 1px solid #e2e8f0; border-radius: 6px; padding: 10px; margin: 5px 0;">
                        <strong>${item.query}</strong>
                        <div style="font-size: 12px; color: #718096;">
                            Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡: ${item.timestamp}
                        </div>
                    </div>
                `).join('');
            }
            
            cacheView.style.display = 'block';
        }

        // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        document.addEventListener('DOMContentLoaded', () => {
            renderUI();
        });
    </script>
</body>
</html>
