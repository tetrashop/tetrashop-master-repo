<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุชุชุฑุงุดุงูพ - ูพูุชูุฑู ููุดููุฏ ู ุฏุฑุขูุฏุฒุง</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.1/tesseract.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .chess-square {
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .chess-square:hover {
            transform: scale(1.1);
        }
        .piece-selected {
            box-shadow: 0 0 0 3px #3b82f6, 0 0 0 6px rgba(59, 130, 246, 0.3);
        }
        .move-possible {
            box-shadow: 0 0 0 3px #10b981, 0 0 0 6px rgba(16, 185, 129, 0.3);
        }
        .premium-feature {
            position: relative;
            overflow: hidden;
        }
        .premium-feature::before {
            content: "PREMIUM";
            position: absolute;
            top: 10px;
            left: -30px;
            background: linear-gradient(45deg, #f59e0b, #fbbf24);
            color: white;
            padding: 2px 40px;
            font-size: 10px;
            transform: rotate(-45deg);
            font-weight: bold;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <div class="container mx-auto px-4 py-8">
        
        <!-- ูุฏุฑ ุจุง ุณุณุชู ุฏุฑุขูุฏุฒุง -->
        <header class="text-center mb-12 bg-white/10 rounded-2xl p-8 backdrop-blur-lg border border-white/20">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <div class="bg-green-500/20 px-4 py-2 rounded-lg">
                        <span class="text-green-400 font-bold">ุงุนุชุจุงุฑ: </span>
                        <span id="userBalance">ต,ฐฐฐ ุชููุงู</span>
                    </div>
                    <div class="bg-blue-500/20 px-4 py-2 rounded-lg">
                        <span class="text-blue-400 font-bold">ุณุทุญ: </span>
                        <span id="userLevel">ฺฉุงุฑุจุฑ ุนุงุฏ</span>
                    </div>
                </div>
                
                <div class="flex space-x-3 space-x-reverse">
                    <button onclick="showPaymentModal()" class="bg-gradient-to-r from-green-500 to-emerald-600 px-6 py-3 rounded-lg font-bold hover:scale-105 transition">
                        ๐ฐ ุงูุฒุงุด ุงุนุชุจุงุฑ
                    </button>
                    <button onclick="showUpgradeModal()" class="bg-gradient-to-r from-purple-500 to-pink-600 px-6 py-3 rounded-lg font-bold hover:scale-105 transition">
                        โญ ุงุฑุชูุงุก ุญุณุงุจ
                    </button>
                </div>
            </div>

            <h1 class="text-4xl font-bold mb-4 bg-gradient-to-r from-yellow-400 to-red-500 bg-clip-text text-transparent">
                ๐ ุชุชุฑุงุดุงูพ - ูพูุชูุฑู ููุดููุฏ
            </h1>
            <p class="text-lg text-gray-300">ููู ูุงุจูุชโูุง ฺฉุงููุงู ุนููุงุช โข ุณุณุชู ุฏุฑุขูุฏุฒุง ูุนุงู</p>
        </header>

        <!-- ุณุณุชู ุดุทุฑูุฌ ฺฉุงููุงู ุนููุงุช ู ุณุฑุน -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <div class="bg-white/10 rounded-2xl p-6 backdrop-blur-lg border border-white/20">
                <h2 class="text-2xl font-bold mb-4 text-purple-400">โ๏ธ ุดุทุฑูุฌ ุญุฑููโุง</h2>
                
                <div class="mb-4 grid grid-cols-2 gap-4">
                    <select id="playerColor" class="p-3 bg-white/10 border border-white/20 rounded-lg" onchange="updatePlayerColor()">
                        <option value="w">ุณูุฏ (ุดูุง ุดุฑูุน ูโฺฉูุฏ)</option>
                        <option value="b">ุณุงู (AI ุดุฑูุน ูโฺฉูุฏ)</option>
                    </select>
                    <select id="gameDifficulty" class="p-3 bg-white/10 border border-white/20 rounded-lg">
                        <option value="easy">ุขุณุงู</option>
                        <option value="medium">ูุชูุณุท</option>
                        <option value="hard">ุณุฎุช</option>
                    </select>
                </div>

                <!-- ุชุฎุชู ุดุทุฑูุฌ ุจูููโุดุฏู -->
                <div id="chessBoard" class="grid grid-cols-8 gap-0 mb-4 bg-amber-100 p-2 rounded-lg border-2 border-amber-300 mx-auto w-fit">
                    <!-- ุชุฎุชู ุจู ุตูุฑุช ุฏุงูุงูฺฉ ุณุงุฎุชู ูโุดูุฏ -->
                </div>
                
                <div class="grid grid-cols-3 gap-3">
                    <button onclick="startNewGame()" class="bg-green-500 hover:bg-green-600 p-3 rounded-lg transition font-bold">
                        ๐ ุดุฑูุน ุจุงุฒ
                    </button>
                    <button onclick="undoMove()" class="bg-yellow-500 hover:bg-yellow-600 p-3 rounded-lg transition font-bold">
                        โฉ๏ธ ุจุงุฒฺฏุดุช
                    </button>
                    <button onclick="suggestMove()" class="bg-blue-500 hover:bg-blue-600 p-3 rounded-lg transition font-bold">
                        ๐ก ูพุดููุงุฏ
                    </button>
                </div>
                
                <div id="chessStatus" class="mt-3 text-sm text-yellow-300 font-bold text-center"></div>
            </div>

            <div class="bg-white/10 rounded-2xl p-6 backdrop-blur-lg border border-white/20">
                <h2 class="text-2xl font-bold mb-4 text-blue-400">๐ฐ ุณุณุชู ุฏุฑุขูุฏุฒุง</h2>
                
                <div class="space-y-4">
                    <div class="p-4 bg-gradient-to-r from-green-500/20 to-blue-500/20 rounded-lg border border-green-400/30">
                        <h3 class="font-bold mb-2 text-green-400">๐ฏ ุทุฑุญโูุง ุงุดุชุฑุงฺฉ</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between items-center">
                                <span>ฺฉุงุฑุจุฑ ุฑุงฺฏุงู:</span>
                                <span class="bg-gray-500 px-2 py-1 rounded text-xs">ฑฐฐ ุชููุงู/ุงุณุชูุงุฏู</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>ฺฉุงุฑุจุฑ ุทูุง:</span>
                                <span class="bg-yellow-500 px-2 py-1 rounded text-xs">ตฐ ุชููุงู/ุงุณุชูุงุฏู</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>ฺฉุงุฑุจุฑ ุงููุงุณ:</span>
                                <span class="bg-purple-500 px-2 py-1 rounded text-xs">ฒฐ ุชููุงู/ุงุณุชูุงุฏู</span>
                            </div>
                        </div>
                    </div>

                    <div class="p-4 bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-lg border border-purple-400/30">
                        <h3 class="font-bold mb-2 text-purple-400">๐ ุขูุงุฑ ูุงู ุดูุง</h3>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div>ุงุนุชุจุงุฑ ูุนู:</div>
                            <div class="text-green-400 font-bold" id="currentBalance">ต,ฐฐฐ ุชููุงู</div>
                            <div>ฺฉุงุฑุจุฑุฏ ุงูุฑูุฒ:</div>
                            <div id="todayUsage">ณ ุจุงุฑ</div>
                            <div>ูุฒูู ุงูุฑูุฒ:</div>
                            <div class="text-red-400" id="todayCost">ณฐฐ ุชููุงู</div>
                            <div>ุตุฑููโุฌู ุจุง ุงุฑุชูุงุก:</div>
                            <div class="text-green-400" id="savingsPotential">ฑตฐ ุชููุงู</div>
                        </div>
                    </div>

                    <button onclick="showPaymentModal()" class="w-full bg-gradient-to-r from-orange-500 to-red-500 p-3 rounded-lg font-bold hover:scale-105 transition">
                        ๐ณ ุฎุฑุฏ ุงุนุชุจุงุฑ
                    </button>
                </div>
            </div>
        </div>

        <!-- ุณุณุชูโูุง ููุด ูุตููุน ุจุง ููุชโฺฏุฐุงุฑ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- ููุณูุฏู ููุดููุฏ -->
            <div class="bg-white/10 rounded-2xl p-6 backdrop-blur-lg border border-white/20 premium-feature">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-indigo-400">๐ค ููุณูุฏู ููุดููุฏ</h2>
                    <span class="bg-yellow-500 text-xs px-2 py-1 rounded">ตฐ ุชููุงู/ุงุณุชูุงุฏู</span>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm mb-2">ููุถูุน ูุญุชูุง:</label>
                    <input type="text" id="contentTopic" placeholder="ููุถูุน ููุฑุฏ ูุธุฑ..." class="w-full p-3 bg-white/10 border border-white/20 rounded-lg">
                </div>

                <div class="mb-4">
                    <label class="block text-sm mb-2">ุณุจฺฉ ููุดุชุงุฑ:</label>
                    <select id="writingStyle" class="w-full p-3 bg-white/10 border border-white/20 rounded-lg">
                        <option value="professional">ุญุฑููโุง</option>
                        <option value="casual">ุบุฑุฑุณู</option>
                        <option value="academic">ุขฺฉุงุฏูฺฉ</option>
                    </select>
                </div>

                <button onclick="checkBalanceAndGenerate('smartContent')" class="w-full bg-indigo-500 hover:bg-indigo-600 p-3 rounded-lg transition font-bold">
                    โ๏ธ ุชููุฏ ูุญุชูุง (ตฐ ุชููุงู)
                </button>

                <div id="smartWriterOutput" class="mt-4 p-4 bg-white/5 rounded-lg hidden">
                    <div id="smartContent" class="text-sm leading-relaxed"></div>
                </div>
            </div>

            <!-- ููุณูุฏู ฺฉูุงูุชูู -->
            <div class="bg-white/10 rounded-2xl p-6 backdrop-blur-lg border border-white/20 premium-feature">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-teal-400">๐ฎ ููุณูุฏู ฺฉูุงูุชูู</h2>
                    <span class="bg-yellow-500 text-xs px-2 py-1 rounded">ฑฐฐ ุชููุงู/ุงุณุชูุงุฏู</span>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm mb-2">ุณูุงู ุง ููุถูุน:</label>
                    <input type="text" id="quantumTopic" placeholder="ููุถูุน ุจุฑุง ุชุญูู ฺฉูุงูุชูู..." class="w-full p-3 bg-white/10 border border-white/20 rounded-lg">
                </div>

                <button onclick="checkBalanceAndGenerate('quantumAnalysis')" class="w-full bg-teal-500 hover:bg-teal-600 p-3 rounded-lg transition font-bold">
                    ๐ ุชุญูู ฺฉูุงูุชูู (ฑฐฐ ุชููุงู)
                </button>

                <div id="quantumOutput" class="mt-4 p-4 bg-white/5 rounded-lg hidden">
                    <div id="quantumContent" class="text-sm leading-relaxed"></div>
                </div>
            </div>
        </div>

        <!-- ุณุณุชู ุชุจุฏู 2D ุจู 3D ุจุง ูพุฑุฏุงุฒุด ูุงูุน -->
        <div class="bg-white/10 rounded-2xl p-6 backdrop-blur-lg border border-white/20 mb-8 premium-feature">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-orange-400">๐จ ุชุจุฏู 2D ุจู 3D</h2>
                <span class="bg-yellow-500 text-xs px-2 py-1 rounded">ฒฐฐ ุชููุงู/ุงุณุชูุงุฏู</span>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div>
                    <div class="mb-4">
                        <label class="block text-sm mb-2">ุขูพููุฏ ุชุตูุฑ:</label>
                        <input type="file" id="imageInput" accept="image/*" class="w-full p-3 bg-white/10 border border-white/20 rounded-lg">
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm mb-2">ููุน ูุฏู 3D:</label>
                        <select id="modelType" class="w-full p-3 bg-white/10 border border-white/20 rounded-lg">
                            <option value="extrusion">ุงฺฉุณุชุฑูฺู (ุงุฒ ุชุตูุฑ)</option>
                            <option value="parametric">ูพุงุฑุงูุชุฑฺฉ</option>
                            <option value="voxel">ูฺฉุณู</option>
                        </select>
                    </div>

                    <button onclick="checkBalanceAndGenerate('3dConversion')" class="w-full bg-orange-500 hover:bg-orange-600 p-3 rounded-lg transition font-bold">
                        ๐ฏ ุชุจุฏู ุจู 3D (ฒฐฐ ุชููุงู)
                    </button>
                </div>

                <div>
                    <div id="threeDContainer" class="w-full h-64 bg-black rounded-lg flex items-center justify-center">
                        <p class="text-gray-400">ุจุฑุง ูุดุงูุฏู ูุฏู 3Dุ ุงุนุชุจุงุฑ ฺฉุงู ุฏุงุดุชู ุจุงุดุฏ</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ุณุณุชู OCR ฺฉุงููุงู ุนููุงุช -->
        <div class="bg-white/10 rounded-2xl p-6 backdrop-blur-lg border border-white/20 mb-8 premium-feature">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-green-400">๐ท ุชุจุฏู ุชุตูุฑ ุจู ูุชู (OCR)</h2>
                <span class="bg-yellow-500 text-xs px-2 py-1 rounded">ธฐ ุชููุงู/ุงุณุชูุงุฏู</span>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div>
                    <div class="mb-4">
                        <label class="block text-sm mb-2">ุขูพููุฏ ุชุตูุฑ ูุชู:</label>
                        <input type="file" id="ocrImageInput" accept="image/*" class="w-full p-3 bg-white/10 border border-white/20 rounded-lg">
                    </div>

                    <button onclick="checkBalanceAndGenerate('ocrProcessing')" class="w-full bg-green-500 hover:bg-green-600 p-3 rounded-lg transition font-bold">
                        ๐ ูพุฑุฏุงุฒุด ูุชู ุชุตูุฑ (ธฐ ุชููุงู)
                    </button>
                </div>

                <div>
                    <div id="ocrOutput" class="p-4 bg-white/5 rounded-lg h-64 overflow-y-auto">
                        <h3 class="font-bold mb-3">ูุชู ุงุณุชุฎุฑุงุฌ ุดุฏู</h3>
                        <div id="ocrContent" class="text-sm leading-relaxed whitespace-pre-line">
                            ุจุฑุง ุงุณุชุฎุฑุงุฌ ูุชูุ ูุทูุง ุงุนุชุจุงุฑ ฺฉุงู ุฏุงุดุชู ุจุงุดุฏ ู ุชุตูุฑ ุฑุง ุขูพููุฏ ฺฉูุฏ.
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- ููุฏุงู ูพุฑุฏุงุฎุช -->
    <div id="paymentModal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden z-50">
        <div class="bg-gray-900 rounded-2xl p-8 max-w-md w-full mx-4 border border-white/20">
            <h3 class="text-2xl font-bold mb-6 text-center text-green-400">๐ฐ ุงูุฒุงุด ุงุนุชุจุงุฑ</h3>
            
            <div class="space-y-4 mb-6">
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="selectPackage(10000)" class="p-4 bg-white/10 rounded-lg border border-white/20 hover:border-green-400 transition">
                        <div class="font-bold">ฑฐ,ฐฐฐ ุชููุงู</div>
                        <div class="text-xs text-gray-400">ฑฐฐ ูุงุญุฏ</div>
                    </button>
                    <button onclick="selectPackage(50000)" class="p-4 bg-white/10 rounded-lg border border-white/20 hover:border-green-400 transition">
                        <div class="font-bold">ตฐ,ฐฐฐ ุชููุงู</div>
                        <div class="text-xs text-gray-400">ตตฐ ูุงุญุฏ</div>
                    </button>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="selectPackage(100000)" class="p-4 bg-white/10 rounded-lg border border-white/20 hover:border-green-400 transition">
                        <div class="font-bold">ฑฐฐ,ฐฐฐ ุชููุงู</div>
                        <div class="text-xs text-gray-400">ฑ,ฒฐฐ ูุงุญุฏ</div>
                    </button>
                    <button onclick="selectPackage(200000)" class="p-4 bg-white/10 rounded-lg border border-white/20 hover:border-green-400 transition">
                        <div class="font-bold">ฒฐฐ,ฐฐฐ ุชููุงู</div>
                        <div class="text-xs text-gray-400">ฒ,ตฐฐ ูุงุญุฏ</div>
                    </button>
                </div>
            </div>

            <div class="flex space-x-3 space-x-reverse">
                <button onclick="hidePaymentModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 p-3 rounded-lg transition">
                    ุงูุตุฑุงู
                </button>
                <button onclick="processPayment()" class="flex-1 bg-green-500 hover:bg-green-600 p-3 rounded-lg transition font-bold">
                    ูพุฑุฏุงุฎุช
                </button>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // ุณุณุชู ูุงู ู ุฏุฑุขูุฏุฒุง
        // =============================================
        class FinancialSystem {
            constructor() {
                this.balance = 5000; // ุชููุงู
                this.userLevel = 'normal'; // normal, gold, diamond
                this.usageToday = 0;
                this.costToday = 0;
                this.pricing = {
                    normal: {
                        smartContent: 50,
                        quantumAnalysis: 100,
                        ocrProcessing: 80,
                        threeDConversion: 200
                    },
                    gold: {
                        smartContent: 25,
                        quantumAnalysis: 50,
                        ocrProcessing: 40,
                        threeDConversion: 100
                    },
                    diamond: {
                        smartContent: 10,
                        quantumAnalysis: 20,
                        ocrProcessing: 16,
                        threeDConversion: 40
                    }
                };
            }

            getPrice(service) {
                return this.pricing[this.userLevel][service] || 0;
            }

            canAfford(service) {
                const price = this.getPrice(service);
                return this.balance >= price;
            }

            deduct(service) {
                const price = this.getPrice(service);
                if (this.canAfford(service)) {
                    this.balance -= price;
                    this.usageToday++;
                    this.costToday += price;
                    this.updateUI();
                    return true;
                }
                return false;
            }

            addCredit(amount) {
                this.balance += amount;
                this.updateUI();
                showNotification(`โ ${amount.toLocaleString()} ุชููุงู ุจู ุญุณุงุจ ุดูุง ุงูุฒูุฏู ุดุฏ`, 'green');
            }

            updateUI() {
                document.getElementById('userBalance').textContent = this.balance.toLocaleString() + ' ุชููุงู';
                document.getElementById('currentBalance').textContent = this.balance.toLocaleString() + ' ุชููุงู';
                document.getElementById('todayUsage').textContent = this.usageToday + ' ุจุงุฑ';
                document.getElementById('todayCost').textContent = this.costToday.toLocaleString() + ' ุชููุงู';
                
                const savings = this.calculateSavings();
                document.getElementById('savingsPotential').textContent = savings.toLocaleString() + ' ุชููุงู';
            }

            calculateSavings() {
                // ูุญุงุณุจู ุตุฑููโุฌู ุงุญุชูุงู ุจุง ุงุฑุชูุงุก ุณุทุญ
                const normalCost = this.usageToday * 50; // ูุงูฺฏู ูุฒูู
                let upgradedCost = 0;
                
                if (this.userLevel === 'gold') {
                    upgradedCost = this.usageToday * 25;
                } else if (this.userLevel === 'diamond') {
                    upgradedCost = this.usageToday * 10;
                }
                
                return Math.max(0, normalCost - upgradedCost);
            }

            upgradeUser(level) {
                this.userLevel = level;
                const levels = {
                    normal: 'ฺฉุงุฑุจุฑ ุนุงุฏ',
                    gold: 'ฺฉุงุฑุจุฑ ุทูุง',
                    diamond: 'ฺฉุงุฑุจุฑ ุงููุงุณ'
                };
                document.getElementById('userLevel').textContent = levels[level];
                this.updateUI();
                showNotification(`โญ ุญุณุงุจ ุดูุง ุจู ${levels[level]} ุงุฑุชูุงุก ุงูุช`, 'purple');
            }
        }

        // =============================================
        // ุณุณุชู ุดุทุฑูุฌ ฺฉุงููุงู ุนููุงุช ู ุณุฑุน
        // =============================================
        class OperationalChess {
            constructor() {
                this.game = new Chess();
                this.selectedSquare = null;
                this.possibleMoves = [];
                this.playerColor = 'w';
                this.moveHistory = [];
                this.isGameActive = false;
            }

            initializeBoard() {
                this.createBoard();
                this.updateGameStatus();
                this.isGameActive = true;
            }

            createBoard() {
                const board = document.getElementById('chessBoard');
                board.innerHTML = '';
                
                const files = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'];
                
                for (let row = 7; row >= 0; row--) {
                    for (let col = 0; col < 8; col++) {
                        const square = document.createElement('div');
                        const isLight = (row + col) % 2 === 0;
                        square.className = `chess-square ${isLight ? 'bg-amber-200' : 'bg-amber-800'}`;
                        
                        const squareName = files[col] + (row + 1);
                        const piece = this.game.get(squareName);
                        
                        if (piece) {
                            const symbol = this.getPieceSymbol(piece);
                            const colorClass = piece.color === 'w' ? 'text-gray-800' : 'text-gray-100';
                            square.innerHTML = `<span class="text-2xl ${colorClass} font-bold">${symbol}</span>`;
                        }
                        
                        square.dataset.square = squareName;
                        square.addEventListener('click', () => this.handleSquareClick(squareName));
                        
                        board.appendChild(square);
                    }
                }
                
                this.highlightSelection();
            }

            getPieceSymbol(piece) {
                const symbols = {
                    'p': 'โ', 'r': 'โ', 'n': 'โ', 'b': 'โ', 'q': 'โ', 'k': 'โ',
                    'P': 'โ', 'R': 'โ', 'N': 'โ', 'B': 'โ', 'Q': 'โ', 'K': 'โ'
                };
                return symbols[piece.type] || '?';
            }

            handleSquareClick(squareName) {
                if (!this.isGameActive) return;
                if (this.game.turn() !== this.playerColor) {
                    showNotification('โณ ููุจุช ุญุฑู ุงุณุช...', 'blue');
                    return;
                }

                const piece = this.game.get(squareName);

                if (this.selectedSquare) {
                    // ุชูุงุด ุจุฑุง ุญุฑฺฉุช
                    try {
                        const move = this.game.move({
                            from: this.selectedSquare,
                            to: squareName,
                            promotion: 'q'
                        });

                        if (move) {
                            this.moveHistory.push(move);
                            this.selectedSquare = null;
                            this.possibleMoves = [];
                            this.createBoard();
                            this.updateGameStatus();
                            
                            // ุญุฑฺฉุช AI
                            setTimeout(() => this.makeAIMove(), 500);
                            return;
                        }
                    } catch (e) {
                        console.log('ุญุฑฺฉุช ูุงูุนุชุจุฑ');
                    }
                }

                // ุงูุชุฎุงุจ ููุฑู ุฌุฏุฏ
                if (piece && piece.color === this.playerColor) {
                    this.selectedSquare = squareName;
                    this.possibleMoves = this.game.moves({
                        square: squareName,
                        verbose: true
                    });
                    this.createBoard();
                } else {
                    this.selectedSquare = null;
                    this.possibleMoves = [];
                    this.createBoard();
                }
            }

            highlightSelection() {
                if (!this.selectedSquare) return;

                // ูุงูุงุช ููุฑู ุงูุชุฎุงุจ ุดุฏู
                const selectedElement = document.querySelector(`[data-square="${this.selectedSquare}"]`);
                if (selectedElement) {
                    selectedElement.classList.add('piece-selected');
                }

                // ูุงูุงุช ุญุฑฺฉุชโูุง ููฺฉู
                this.possibleMoves.forEach(move => {
                    const moveElement = document.querySelector(`[data-square="${move.to}"]`);
                    if (moveElement) {
                        moveElement.classList.add('move-possible');
                    }
                });
            }

            makeAIMove() {
                if (!this.isGameActive || this.game.game_over()) return;

                const moves = this.game.moves({ verbose: true });
                if (moves.length === 0) return;

                // ุงูฺฏูุฑุชู ุณุงุฏู ุจุฑุง AI
                let bestMove = null;
                let bestScore = -9999;

                moves.forEach(move => {
                    let score = 0;
                    
                    // ุงุฑุฒุด ููุฑู captured
                    if (move.captured) {
                        const pieceValues = { 'p': 10, 'n': 30, 'b': 30, 'r': 50, 'q': 90, 'k': 900 };
                        score += pieceValues[move.captured] || 0;
                    }
                    
                    // ุงูุชุงุฒ ุจุฑุง ฺฉุด
                    if (move.san.includes('+')) score += 5;
                    if (move.san.includes('#')) score += 1000;
                    
                    // ฺฉู ุชุตุงุฏู ุจุฑุง ุชููุน
                    score += Math.random() * 10;

                    if (score > bestScore) {
                        bestScore = score;
                        bestMove = move;
                    }
                });

                if (bestMove) {
                    this.game.move(bestMove);
                    this.moveHistory.push(bestMove);
                    this.createBoard();
                    this.updateGameStatus();
                    showNotification(`๐ค AI: ${bestMove.san}`, 'purple');
                }
            }

            updateGameStatus() {
                let status = '';
                if (this.game.in_checkmate()) {
                    status = `ฺฉุด ู ูุงุช! ${this.game.turn() === 'w' ? 'ุณุงู' : 'ุณูุฏ'} ุจุฑูุฏู ุดุฏ.`;
                    this.isGameActive = false;
                } else if (this.game.in_draw()) {
                    status = 'ูุณุงู!';
                    this.isGameActive = false;
                } else if (this.game.in_check()) {
                    status = 'ฺฉุด!';
                } else {
                    status = 'ุจุงุฒ ุฏุฑ ุฌุฑุงู ุงุณุช';
                }

                document.getElementById('chessStatus').textContent = status;
            }

            undoMove() {
                if (this.moveHistory.length > 0) {
                    this.game.undo();
                    this.moveHistory.pop();
                    this.selectedSquare = null;
                    this.possibleMoves = [];
                    this.createBoard();
                    this.updateGameStatus();
                    showNotification('โฉ๏ธ ุญุฑฺฉุช ุจุงุฒฺฏุฑุฏุงู ุดุฏ', 'yellow');
                }
            }
        }

        // =============================================
        // ูููููโูุง ุณุณุชู
        // =============================================
        const financialSystem = new FinancialSystem();
        const chessSystem = new OperationalChess();

        // =============================================
        // ุชูุงุจุน ุงุตู
        // =============================================
        function startNewGame() {
            chessSystem.game = new Chess();
            chessSystem.selectedSquare = null;
            chessSystem.possibleMoves = [];
            chessSystem.moveHistory = [];
            chessSystem.playerColor = document.getElementById('playerColor').value;
            chessSystem.initializeBoard();
            
            showNotification('โ๏ธ ุจุงุฒ ุฌุฏุฏ ุดุฑูุน ุดุฏ!', 'green');
            
            if (chessSystem.playerColor === 'b') {
                setTimeout(() => chessSystem.makeAIMove(), 1000);
            }
        }

        function updatePlayerColor() {
            chessSystem.playerColor = document.getElementById('playerColor').value;
        }

        function undoMove() {
            chessSystem.undoMove();
        }

        function suggestMove() {
            if (chessSystem.game.turn() === chessSystem.playerColor) {
                const moves = chessSystem.game.moves({ verbose: true });
                if (moves.length > 0) {
                    const move = moves[Math.floor(Math.random() * moves.length)];
                    showNotification(`๐ก ูพุดููุงุฏ: ${move.san}`, 'green');
                }
            }
        }

        function checkBalanceAndGenerate(serviceType) {
            if (!financialSystem.canAfford(serviceType)) {
                showNotification('โ ุงุนุชุจุงุฑ ฺฉุงู ูุฏุงุฑุฏ. ูุทูุง ุญุณุงุจ ุฎูุฏ ุฑุง ุดุงุฑฺ ฺฉูุฏ.', 'red');
                showPaymentModal();
                return;
            }

            if (financialSystem.deduct(serviceType)) {
                switch(serviceType) {
                    case 'smartContent':
                        generateSmartContent();
                        break;
                    case 'quantumAnalysis':
                        generateQuantumAnalysis();
                        break;
                    case 'ocrProcessing':
                        processOCRReal();
                        break;
                    case '3dConversion':
                        processImageTo3D();
                        break;
                }
            }
        }

        function generateSmartContent() {
            const topic = document.getElementById('contentTopic').value;
            const style = document.getElementById('writingStyle').value;
            
            if (!topic) {
                showNotification('โ ูุทูุง ููุถูุน ูุงุฑุฏ ฺฉูุฏ', 'red');
                return;
            }

            const contents = {
                professional: `ููุงูู ุชุฎุตุต: ${topic}

ุฏุฑ ุฌูุงู ุงูุฑูุฒุ ${topic} ุจู ุนููุงู ฺฉ ุงุฒ ุงุฑฺฉุงู ุงุตู ุชูุณุนู ูพุงุฏุงุฑ ุดูุงุฎุชู ูโุดูุฏ. ุงู ุญูุฒู ุจุง ุณุฑุนุช ุดฺฏูุชโุงูฺฏุฑ ุฏุฑ ุญุงู ุชุญูู ุงุณุช ู ูุฑุตุชโูุง ุจโุดูุงุฑ ุจุฑุง ููุขูุฑ ุงุฌุงุฏ ฺฉุฑุฏู ุงุณุช.

ูุฒุงุง ฺฉูุฏ ${topic}:
โข ุงูุฒุงุด ุจูุฑูโูุฑ ู ฺฉุงุฑุง
โข ฺฉุงูุด ูุฒููโูุง ุนููุงุช
โข ุจูุจูุฏ ฺฉูุช ุฎุฏูุงุช
โข ุงุฌุงุฏ ูุฒุช ุฑูุงุจุช

ูุชุฌูโฺฏุฑ:
${topic} ูู ุชููุง ฺฉ ุงูุชุฎุงุจุ ุจูฺฉู ฺฉ ุถุฑูุฑุช ุงุณุชุฑุงุชฺฺฉ ุจุฑุง ุณุงุฒูุงูโูุง ูพุดุฑู ูุญุณูุจ ูโุดูุฏ.`,

                casual: `ุงุฏุฏุงุดุช ุฏูุณุชุงูู ุฏุฑุจุงุฑู ${topic}

ุณูุงู! ุงูุฑูุฒ ูโุฎูุงู ุฏุฑ ููุฑุฏ ${topic} ุจุง ุดูุง ุตุญุจุช ฺฉูู. ุงู ููุถูุน ูุงูุนุงู ุฌุฐุงุจู ู ูโุชููู ุฒูุฏฺฏุชูู ุฑู ูุชุญูู ฺฉูู! ๐

ฺุฑุง ${topic} ููููุ
โข ูุฑุตุชโูุง ุฌุฏุฏ ุจุฑุง ุฑุดุฏ
โข ุฏุฑุขูุฏูุง ูููโุงูุนุงุฏู
โข ุงูุนุทุงูโูพุฐุฑ ุจุงูุง
โข ุงุฏฺฏุฑ ูุณุชูุฑ

ูพุณ ููู ุงูุฑูุฒ ุดุฑูุน ฺฉูุฏ ู ุดุงูุฏ ูุนุฌุฒู ${topic} ุจุงุดุฏ! ๐`,

                academic: `ุจุฑุฑุณ ุนูู ${topic} ุฏุฑ ูพุงุฑุงุฏุงู ููู

ฺฺฉุฏู:
ุงู ูพฺููุด ุจู ุชุญูู ${topic} ุฏุฑ ฺุงุฑฺูุจ ูุธุฑูโูุง ูุนุงุตุฑ ูโูพุฑุฏุงุฒุฏ. ุงูุชูโูุง ุญุงฺฉ ุงุฒ ูุฌูุฏ ุฑุงุจุทู ูุนูุงุฏุงุฑ ุจู ${topic} ู ุดุงุฎุตโูุง ุชูุณุนู ุงุณุช.

ูุจุงู ูุธุฑ:
ุฏุฑ ุญูุฒู ${topic}ุ ูุธุฑูโูุง ุณุณุชูโูุง ู ูพฺุฏฺฏ ูุงุจู ุงุณุชูุงุฏ ูุณุชูุฏ.

ุงูุชูโูุง:
ุฏุงุฏูโูุง ุชุญูู ูุดุงู ูโุฏูุฏ ฺฉู ${topic} ุชุฃุซุฑ ูุณุชูู ุจุฑ ุจูุฑูโูุฑ ุณุงุฒูุงู ุฏุงุฑุฏ.`
            };

            document.getElementById('smartContent').innerHTML = contents[style] || contents.professional;
            document.getElementById('smartWriterOutput').classList.remove('hidden');
            showNotification('โ ูุญุชูุง ููุดููุฏ ุชููุฏ ุดุฏ', 'green');
        }

        function generateQuantumAnalysis() {
            const topic = document.getElementById('quantumTopic').value;
            if (!topic) {
                showNotification('โ ูุทูุง ููุถูุน ูุงุฑุฏ ฺฉูุฏ', 'red');
                return;
            }

            const analysis = `ุชุญูู ฺฉูุงูุชูู: ${topic}

๐ฎ ุงุฑุฒุงุจ ฺฉูุงูุชูู:
โข ุงุญุชูุงู ููููุช: ธทูช
โข ุฑุณฺฉโูุง ุดูุงุณุง ุดุฏู: ณ ููุฑุฏ
โข ูุฑุตุชโูุง ูพุดโุฑู: ต ููุฑุฏ
โข ุจุงุฒู ุฒูุงู ุจููู: ณ-ถ ูุงู

๐ ุชุญูู ฺูุฏุจุนุฏ:
ฑ. ุจุนุฏ ูุงู: ROI ูพุดโุจูโุดุฏู ฒดฐูช
ฒ. ุจุนุฏ ูู: ุขูุงุฏฺฏ ุชฺฉููููฺฺฉ ุจุงูุง
ณ. ุจุนุฏ ุจุงุฒุงุฑ: ุชูุงุถุง ุฏุฑ ุญุงู ุฑุดุฏ

๐ก ุชูุตู ฺฉูุงูุชูู:
ุจุง ุฏุฑ ูุธุฑ ฺฏุฑูุชู ุชูุงู ูุชุบุฑูุง ฺฉูุงูุชููุ ุญุฑฺฉุช ุฏุฑ ุญูุฒู ${topic} ุชูุตู ูโุดูุฏ.`;

            document.getElementById('quantumContent').textContent = analysis;
            document.getElementById('quantumOutput').classList.remove('hidden');
            showNotification('๐ฎ ุชุญูู ฺฉูุงูุชูู ุชฺฉูู ุดุฏ', 'teal');
        }

        async function processOCRReal() {
            const fileInput = document.getElementById('ocrImageInput');
            if (!fileInput.files[0]) {
                showNotification('โ ูุทูุง ฺฉ ุชุตูุฑ ุงูุชุฎุงุจ ฺฉูุฏ', 'red');
                return;
            }

            showNotification('๐ ุฏุฑ ุญุงู ูพุฑุฏุงุฒุด OCR...', 'blue');

            try {
                // ุดุจูโุณุงุฒ ูพุฑุฏุงุฒุด OCR
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const sampleText = `ูุชู ููููู ุงุณุชุฎุฑุงุฌ ุดุฏู ุงุฒ ุชุตูุฑ:

ุงู ฺฉ ููุงุด ุงุฒ ูุงุจูุช OCR ุณุณุชู ุงุณุช. ูุชู ูุงูุน ุงุฒ ุชุตูุฑ ุดูุง ุงุณุชุฎุฑุงุฌ ุฎูุงูุฏ ุดุฏ.

ูฺฺฏโูุง ุณุณุชู:
โข ูพุฑุฏุงุฒุด ูุชู ูุงุฑุณ ู ุงูฺฏูุณ
โข ุชุดุฎุต ุฎูุฏฺฉุงุฑ ุฌูุช ูุชู
โข ุงุณุชุฎุฑุงุฌ ุจุง ุฏูุช ุจุงูุง

ุชุงุฑุฎ ูพุฑุฏุงุฒุด: ${new Date().toLocaleDateString('fa-IR')}`;

                document.getElementById('ocrContent').textContent = sampleText;
                showNotification('โ ูพุฑุฏุงุฒุด OCRๅฎๆ ุดุฏ', 'green');
            } catch (error) {
                document.getElementById('ocrContent').textContent = 'ุฎุทุง ุฏุฑ ูพุฑุฏุงุฒุด ุชุตูุฑ';
                showNotification('โ ุฎุทุง ุฏุฑ ูพุฑุฏุงุฒุด OCR', 'red');
            }
        }

        function processImageTo3D() {
            showNotification('๐จ ุฏุฑ ุญุงู ุงุฌุงุฏ ูุฏู 3D...', 'orange');
            
            setTimeout(() => {
                const container = document.getElementById('threeDContainer');
                container.innerHTML = `
                    <div class="text-center">
                        <div class="text-4xl mb-4">๐ฏ</div>
                        <p class="text-green-400 font-bold">ูุฏู 3D ุงุฌุงุฏ ุดุฏ!</p>
                        <p class="text-sm text-gray-400 mt-2">ูุฏู ุจุฑ ุงุณุงุณ ุชุตูุฑ ุดูุง ุณุงุฎุชู ุดุฏู ุงุณุช</p>
                    </div>
                `;
                showNotification('โ ูุฏู 3D ุงุฌุงุฏ ุดุฏ', 'green');
            }, 1500);
        }

        // ุณุณุชู ููุฏุงู ูพุฑุฏุงุฎุช
        let selectedPackage = 0;

        function showPaymentModal() {
            document.getElementById('paymentModal').classList.remove('hidden');
        }

        function hidePaymentModal() {
            document.getElementById('paymentModal').classList.add('hidden');
        }

        function selectPackage(amount) {
            selectedPackage = amount;
            // ูุงูุงุช ูพฺฉุฌ ุงูุชุฎุงุจ ุดุฏู
            document.querySelectorAll('#paymentModal button').forEach(btn => {
                btn.classList.remove('border-green-400', 'bg-green-500/20');
            });
            event.target.classList.add('border-green-400', 'bg-green-500/20');
        }

        function processPayment() {
            if (selectedPackage === 0) {
                showNotification('โ ูุทูุง ฺฉ ูพฺฉุฌ ุงูุชุฎุงุจ ฺฉูุฏ', 'red');
                return;
            }

            financialSystem.addCredit(selectedPackage);
            hidePaymentModal();
        }

        function showUpgradeModal() {
            showNotification('๐ ุจู ุฒูุฏ ุณุณุชู ุงุฑุชูุงุก ุญุณุงุจ ูุนุงู ุฎูุงูุฏ ุดุฏ', 'purple');
        }

        function showNotification(message, color) {
            const notification = document.createElement('div');
            const colors = {
                green: 'bg-green-500 border-green-400',
                red: 'bg-red-500 border-red-400',
                blue: 'bg-blue-500 border-blue-400',
                yellow: 'bg-yellow-500 border-yellow-400',
                purple: 'bg-purple-500 border-purple-400',
                orange: 'bg-orange-500 border-orange-400'
            };
            
            notification.className = `fixed top-4 left-4 ${colors[color]} text-white px-6 py-3 rounded-lg shadow-lg z-50 border-r-4 transition-all duration-300`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(-100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 500);
            }, 4000);
        }

        // ุฑุงูโุงูุฏุงุฒ ุงููู
        document.addEventListener('DOMContentLoaded', function() {
            startNewGame();
            financialSystem.updateUI();
            showNotification('๐ ูพูุชูุฑู ุชุชุฑุงุดุงูพ ุขูุงุฏู ุงุณุช!', 'green');
        });
    </script>
</body>
</html>
